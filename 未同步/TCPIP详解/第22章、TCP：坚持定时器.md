# 第22章 TCP的坚持定时器(零窗口探测定时器)

## 1、引言

```
我们已经看到TCP通过让接收方指明希望从发送方接收的数据字节数(即窗口大小)来进行流量控制。如果窗口大小为0会发生什么情况呢？这将有效地阻止发送方传送数据，直到窗口变为非0为止。
```

```
出现以下情况时，TCP接收方的接收缓冲区讲被塞满数据：
发送方的发送速度大于接收方的接收速度
接收方的应用程序未能及时从接收缓冲区中读取数据
```

```
当接收方的接收缓冲区满了以后，会把响应报文中的通告窗口字段置为0，从而阻止发送方的继续发送，这就是TCP的流控制。当接收方的应用程序读取了接收缓冲区中的数据以后，接收方会发送一个ACK，通过通告窗口字段告诉发送方自己又可以接收数据了，发送方收到这个ACK之后，就知道自己可以继续发送数据了。

ack会有延时发送的 默认200ms.所以win也就是接收窗口在200Ms以内被取走了部分数据的话就会空闲出一部分。
```

```
Q：那么问题来了，当接收方的接收窗口重新打开之后，如果它发送的ACK丢失了，发送方还能得知这一消息吗？
A：答案是不能。正常的ACK报文不需要确认，因而也不会被重传，如果这个ACK丢失了发送方将无法得知对端的接收窗口已经打开了，也就不会继续发送数据。这样以来，会造成死锁，接收方等待对端发送数据包，而发送方等待对端的ACK,直到连接超时关闭.
```

```
为了避免上述情况的发生，发送方实现了一个零窗口探测定时器，也叫持续定时器：
	当接收方的接收窗口为0时，每隔一段时间，发送方会主动发送探测包，通过迫使对端响应来得知其接收窗口有无打开。
	这就是山不过来，我就过去
```

