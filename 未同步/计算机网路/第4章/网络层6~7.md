## 6、IP多播

### 1、IP多播的基本概念

```
1988年 steve Deering 首次在其博士学位论文中提出IP多播的概念。
1992年3月IETF在因特网范围首次试验IETF会议声音的多播，当时有20个网点可同时听到会议的声音。
IP多播是需要在因特网上增加更多的智能才能提供的一种服务。

现在IP多播(multicast, 以前曾译为组播)已成为因特网的一个热门课题。
这是由于有许多的应用需要由一个源点发送到许多个终点，即一对多的通信。

例如，实时信息的交付(如新闻、股市行情等)，软件更新，交互式会议等。
随着因特网的用户数目的急剧增加，以及多媒体通信的开展，有更多的业务需要多播来支持。
关于IP多播可参考[W-MCAST]。
```



![](images03-01/01-01.jpg)

```
与单播相比，在一对多的通信中，多播可大大节约网络资源。
图4-46(a)是视频服务器用单播方式向90个主机传送同样的视频节目。
为此，需要发送90个单播，即同一个视频分组要发送90个副本。

图4-46(b)是视频服务器用多播方式向属于同一个多播组的90个成员传送节目。
这时，视频服务器只需要把视频分组当作多播数据报来发送，并且只需发送一次。

路由器R1在转发分组时，需要把收到的分组复制成3个副本，分别向R2、R3和R4各转发1个副本。
当分组到达目的局域网时，由于局域网具有硬件多播功能，因此不需要复制分组，在局域网上的多播组成员都能收到这个视频分组。
```

```
当多播组的主机数很大时(如成千上万个)，采用多播方式就可明显的减轻网络中各种资源的消耗。
在因特网范围的多播要靠路由器来实现，这些路由器必须增加一些能够识别多播数据报的软件。
能够运行多播协议的路由器称为 多播路由器(multicast router)。
多播路由器当然也可以转发普通的单播IP数据报。
```

```
为了适应交互式音频和视频信息的多播，从1992年起，在因特网上开始试验虚拟的多播主干网MBONE(Multicast Backbone On the InterNEt)。
MBONE可把分组传播给地点分散但属于一个组的许多主机。
现在多播主干网已经有了相当大的规模。
```

```
在因特网上进行多播就叫做 IP 多播。
IP多播所传送的分组需要使用多播IP地址。
我们知道，在因特网中每一个主机必须有一个全球唯一的IP地址。
如果某个主机现在想接收某个特定多播组的分组，那么怎样才能使这个多播数据报传送到这个主机？
```

```
显然，这个多播数据报的目的地址一定不能写入这个主机的IP地址。
这是因为在同一时间可能有成千上万个主机加入到同一个多播组。
多播数据报不可能在其首部写入这样多的主机的IP地址。
在多播数据报的目的地址写入的是多播组的标识符，然后设法让加入到这个多播组的主机的IP地址与多播组的标识符关联起来。
```

```
其实多播组的标识符就是IP地址中的D类地址。
D类IP地址的前四位是1110，因此D类地址范围是224.0.0.0到239.255.255.255(见本章第4.2.2 节第1小节"IP地址及其表示方法")。
我们就用每一个D类地址标志一个多播组。
这样，D类地址共可标志 2^28个多播组，也就是说，在同一时间可以允许有超过2.6亿的多播组在因特网上运行。
多播数据报也是"尽最大努力交付"，不保证一定能够交付多播组内的所有成员。
因此，多播数据报和一般的IP数据报的区别就是它使用D类IP地址作为目的地址，并且首部中的协议字段值是2，表明使用网际组管理协议IGMP。
```

```
显然，多播地址只能用于目的地址，而不能用于源地址。
此外，对多播数据报不产生ICMP差错报文。
因此，若在PING命令后面键入多播地址，将永远不会收到响应。

D类地址中有一些是不能随意使用的，因为有的地址已经被IANA指派为永久组地址了[RFC 5735]。
例如
```

![](images03-01/01-02.jpg)



```
IP 多播可以分为两种。
一种是只在本局域网上进行硬件多播，另一种则是在因特网的范围进行多播。
前一种虽然比较简单，但很重要，因为现在大部分主机都是通过局域网接入到因特网的。
在因特网上进行多播的最后阶段，还是要把多播数据报在局域网上用硬件多播交付多播组的所有成员(如图4-46(b)所示)。
下面就先讨论这种硬件多播。
```



### 2、在局域网上进行硬件多播

```
因特网号码指派管理局IANA 拥有的以太网地址块的高24位为00-00-5E,因此TCP/IP协议使用的以太网多播地址块的范围是从00-00-5E-00-00-00 到 00-00-5E-FF-FF-FF。
在第三章3.4.3节已讲过，以太网硬件地址字段中的第1字节的最低位为1时为多播地址，这种多播地址数占IANA分配到的地址数的一半。
因此IANA拥有的以太网多播地址的范围是从01-00-5E-00-00-00 到 01-00-5E-7F-FF-FF 
为什么mac地址少了一半。。。不清楚；应该是本来就只公开了这一半能使用。

不难看出，在每一个地址中，只有23位可用作多播。
这只能和D类IP地址中的23位有意义对应的关系。

D类IP地址可供分配的有28位，可见在这28位中的前5位不能用来构造以太网硬件地址(图4-47)。

例如，IP多播地址224.128.64.32(即E0-80-40-20)和另一个IP多播地址 224.0.64.32(即E0-00-40-20)转换成以太网的硬件多播地址都试 01-00-5E-00-40-20。
由于多播IP地址与以太网硬件地址的映射关系不是唯一的，因此收到多播数据报的主机，还要在IP层利用软件进行过滤，把不是本主机要接收的数据报丢弃。
```

![](images03-01/01-03.jpg)

下面就讨论进行IP多播所需要的协议



### 3、网际组管理协议IGMP和多播路由选择协议

#### 1、IP多播需要两种协议

![](images03-01/01-04.jpg)

```
图4-48是在因特网上传送多播数据报的例子。
图中标有IP地址的四个主机都参加了一个多播组，其组地址是226.15.37.123。
显然，多播数据报应当传送到路由器 R1,R2,R3,
而不应当传送到路由器R4，因为与R4连接的局域网上现在没有这个多播组的成员。
```



```
图4-48强调了 IGMP 的本地使用范围。
请注意，IGMP并非在因特网范围内对所有多播组成员进行管理的协议。
IGMP不知道IP多播组包含的成员数，也不知道这些成员都分布在哪些网络上，等等。
IGMP协议是让连接在本地局域网上的多播路由器知道本局域网上是否有主机(严格讲，是主机上的某个进程)参加或退出了某个多播组。
```

```
显然，仅有IGMP
```























