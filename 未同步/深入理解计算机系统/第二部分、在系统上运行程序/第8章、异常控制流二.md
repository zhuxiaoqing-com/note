## 5、信号

```
到目前为止对异常控制流的学习中，我们已经看到了硬件和软件是如何合作以提供基本的底层异常机制的。
我们也看到了操作系统如何利用异常来支持进程上下文切换的异常控制流形式。
在本节中，我们将研究一种更高层的软件形式的异常，称为 Linux 信号，它允许进程和内核中断其他进程。
```

```
一个信号就是一条小消息，它通知进程系统中发生了一个某种类型的事件。

每种信号类型都对应于某种系统事件。
底层的硬件异常是由内核异常处理程序处理的，正常情况下，对用户进程而言是不可见的。
信号提供了一种机制，通知用户进程发生了这些异常。
```

![](images08-01-02/01-01.jpg)

![](images08-01-02/01-02.jpg)



### 1、信号术语

```
传送一个信号到目的进程是由两个不同步骤组成的：

发送信号
	内核通过更新目的进程上下文中的某个状态，发送(递送)一个信号给目的进程。
	发送信号可以有如下两种原因：
	1、内核检测到一个系统事件，比如除零错误或者子进程终止。
	2、一个进程调用了 kill 函数，显式的要求内核发送一个信号给目的进程。
	
一个进程可以发送信号给它自己。
```

```
接收信号：
	当目的进程被内核 强迫以某种方式对信号的发送做出反应时，它就接收了信号。
	进程可以忽略这个信号，终止或者通过执行一个称为 信号处理程序(signal handler)的用户层函数捕获这个信号。
	
	图8-27给出了信号处理程序捕获信号的基本思想。
```

![](images08-01-02/01-03.jpg)

```
一个发出而没有被接收的信号叫做待处理信号(pending signal)。
在任何时刻，一种类型至多只会有一个待处理信号。
如果一个进程有一个类型为K的待处理信号，那么任何接下来发送到这个进程的类型为k的信号都不会排队等待;它们只是被简单的丢弃。
一个进程可以有选择性地阻塞接收某种信号。
当一种信号被阻塞时，它仍可以被发送，但是产生的待处理信号不会被接收，直到进程取消对这种信号的阻塞。
```

```
一个待处理信号最多只能被接收一次。内核为每个进程在 pending 位向量中维护着待处理信号的集合，而在 blocked 位向量中维护着被阻塞的信号集合。
只要传送了一个类型为 K 的信号，内核就会设置 pending 中的第 k 位，而只要接收了一个类型为 k 的信号，内核就会清除 Pending 中的第 k 位。
```



### 2、发送信号

```
Unix 系统提供了大量向进程发送信号的机制。
所有这些机制都是基于进程组(process group)这个概念的。
```

#### 1、进程组

```
每个进程都只属于一个进程组，进程组是由一个正整数进程组ID来标识的。

getpgrp函数返回当前进程的进程组ID。
```

![](images08-01-02/01-04.jpg)





























