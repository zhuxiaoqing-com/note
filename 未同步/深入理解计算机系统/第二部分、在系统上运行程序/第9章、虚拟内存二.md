## 8、内存映射

```
需要说明一点，并不是所有物理内存中交换出来的数据都会被放到 Swap 中(如果这样的话，Swap 就会不堪重负)，有相当一部分数据被直接交换到文件系统。
例如，有的程序会打开一些文件，对文件进行读写(其实每个程序都至少要打开一个文件，那就是运行程序本身)，当需要将这些程序的内存空间交换出去时，就没有必要将文件部分的数据放到 swap 空间中了，而可以直接将其放到文件里去。
如果是读文件操作，那么内存数据被直接释放，不需要交换出来，因为下次需要时，可直接从文件系统恢复;
如果是写文件，只需要将变化的数据保存到文件中，以便恢复。
但是那些用 malloc 和 new 函数生成的对象的数据则不同，它们需要 swap 空间，因为它们在文件系统中没有相应的"储备"文件，因此被称作"匿名"(Anonymous)内存数据。
这类数据还包括堆栈中的一些状态和变量数据等。
所以说,Swap 空间是"匿名"数据的交换空间。
```



```
Linux 通过将一个虚拟内存区域与一个磁盘上的对象(object)关联起来，以初始化这个虚拟内存区域的内容，这个过程称为内存映射(memory mapping)。
虚拟内存区域可以映射到两种类型的对象中的一种：
```

```
1、Linux 文件系统中的普通文件：
一个区域可以映射到一个普通文件的连续部分，例如一个可执行文件。
文件区(section)被分为页大小的片，每一片包含一个虚拟页面的初始内容。
因为按需进行页面调度，所以这些虚拟页面没有实际交换进入物理内存，直到CPU第一次引用到页面(即发射一个虚拟地址，落在地址空间这个页面的范围之内)。
如果区域比文件区要大，那么就用零来填充这个区域的余下部分。

虚拟页面的初始内容是什么？
估计是虚拟页面刚创建的时候的内容，就是里面是磁盘页的地址。
```

